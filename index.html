<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‹œì¥ ì§€í‘œ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>window.tailwind=window.tailwind||{};tailwind.config={darkMode:'class'};</script>
  <style>
    .card { border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.08); padding: 1rem; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-zinc-50 to-zinc-100 dark:from-black dark:to-zinc-950 text-zinc-900 dark:text-zinc-100">
  <header class="sticky top-0 z-50 bg-white/70 dark:bg-zinc-900/70 backdrop-blur border-b border-zinc-200/60 dark:border-zinc-800/60">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="text-xl font-bold">ğŸ“Š ì‹œì¥ ì§€í‘œ ëŒ€ì‹œë³´ë“œ</div>
      <div class="ml-auto flex items-center gap-2 text-sm">
        <button id="themeToggle" class="px-3 py-1 rounded-xl border border-zinc-300 dark:border-zinc-700">ë¼ì´íŠ¸/ë‹¤í¬</button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4 space-y-4">
    <!-- ì£¼ìš” ì§€ìˆ˜/í™˜ìœ¨ -->
    <section class="card">
      <div class="text-lg font-semibold mb-2">ì£¼ìš” ì§€ìˆ˜/í™˜ìœ¨ ë¹ ë¥¸ ë³´ê¸°</div>
      <!-- ìœ„ì ¯ì„ ë™ì ìœ¼ë¡œ ë„£ì„ ì»¨í…Œì´ë„ˆ -->
      <div id="tv-ticker" class="tv-wrap" style="height:60px;"></div>
    </section>

    <!-- ë¦¬ì„œì¹˜ & ì‹œí™© -->
    <section class="card">
      <div class="text-lg font-semibold mb-2">ë¦¬ì„œì¹˜ & ì‹œí™© ë°”ë¡œê°€ê¸°</div>
      <div class="flex flex-wrap gap-2 text-sm">
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://markets.hankyung.com/consensus">í•œê²½ ì»¨ì„¼ì„œìŠ¤</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://finance.naver.com/research/">ë„¤ì´ë²„ ì¦ê¶Œ ë¦¬ì„œì¹˜</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://www1.kiwoom.com/m/invest/research/VAnalCHView?dummyVal=0">í‚¤ì›€ì¦ê¶Œ ì¤‘êµ­/ì‹ í¥êµ­</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://securities.miraeasset.com/bbs/board/message/list.do?categoryId=1800&selectedId=1531&searchType=2&searchStartYear=2024&searchStartMonth=10&searchStartDay=17&searchEndYear=2025&searchEndMonth=10&searchEndDay=17&listType=1&startId=zzzzz~&startPage=1&curPage=1&direction=1">ë¯¸ë˜ì—ì…‹ í•´ì™¸ê¸°ì—… ë¦¬í¬íŠ¸</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://guba.eastmoney.com/">ë™ë°©ì¬ë¶€ êµ¬ë°”</a>
      </div>
    </section>

    <!-- ì‹¬ë¦¬ Â· í¬ì§€ì…”ë‹ -->
    <section class="card">
      <div class="text-lg font-semibold mb-2">ì‹¬ë¦¬ Â· í¬ì§€ì…”ë‹</div>
      <div class="flex flex-wrap gap-2 text-sm">
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://www.cnn.com/markets/fear-and-greed">CNN Fear & Greed</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://www.naaim.org/programs/naaim-exposure-index/">NAAIM Exposure Index</a>
        <a class="px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://www.aaii.com/sentimentsurvey">AAII Sentiment Survey</a>
      </div>
    </section>

    <!-- ì¤‘êµ­ í…Œë§ˆ ì´ë¯¸ì§€ -->
    <section class="card">
      <img src="assets/china_bull.jpg" alt="ì¤‘êµ­ ì¦ì‹œ ë ë¦¬" class="w-full h-auto block rounded-xl" loading="lazy"/>
    </section>

    <!-- í…”ë ˆê·¸ë¨ -->
    <section class="card">
      <div class="text-lg font-semibold mb-2">í…”ë ˆê·¸ë¨ ê³µì‹ ì±„ë„ ìµœì‹  ë©”ì‹œì§€</div>
      <div id="tg-jkc"></div>
    </section>

    <!-- ê²½ì œì§€í‘œ ìº˜ë¦°ë” -->
    <section class="card">
      <div class="text-lg font-semibold mb-2">ì´ë²ˆ ì£¼ ê²½ì œì§€í‘œ ìº˜ë¦°ë”</div>
      <!-- ë™ì  ì»¨í…Œì´ë„ˆ -->
      <div id="tv-events" class="tv-wrap" style="height:420px;"></div>
    </section>

    <footer class="py-6 text-center text-xs opacity-70">Â© ê°œì¸ íˆ¬ì ëŒ€ì‹œë³´ë“œ Â· ìë£Œ: TradingView</footer>
  </main>

  <!-- í…Œë§ˆ í† ê¸€ -->
  <script>
    const btn=document.getElementById('themeToggle');
    const root=document.documentElement;
    function setTheme(m){if(m==='dark'){root.classList.add('dark');localStorage.setItem('theme','dark');}else{root.classList.remove('dark');localStorage.setItem('theme','light');}}
    const saved=localStorage.getItem('theme');
    if(saved){setTheme(saved);}else{setTheme(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light');}
    btn.addEventListener('click',()=>{setTheme(root.classList.contains('dark')?'light':'dark'); renderTradingView();});
  </script>

  <!-- í…”ë ˆê·¸ë¨ í”¼ë“œ (jkc123, ìµœì‹  4ê°œ) -->
  <script>
    const WORKER_BASE = "https://wo-de-telegram-proxy.snupil38kor.workers.dev";
    const FEEDS = [{ channel: "jkc123", title: "jkc123", mount: "tg-jkc" }];

    function fmtDate(s){ try { return new Date(s).toLocaleString('ko-KR'); } catch { return s; } }

    function renderFeed({mount,title},items){
      const el=document.getElementById(mount);
      const getDate = (it) => new Date(it.date_published || it.pubDate || it.isoDate || 0);
      const top=(items||[]).slice().sort((a,b)=>getDate(b)-getDate(a)).slice(0,4).map(it=>`
        <a class="block rounded-xl border border-zinc-200/60 dark:border-zinc-800/60 p-3 hover:bg-zinc-100/60 dark:hover:bg-zinc-800/40 transition"
           target="_blank" href="${it.url||it.link||'#'}">
          <div class="text-xs opacity-70">${getDate(it).toLocaleString('ko-KR')}</div>
          <div class="font-medium my-1">${it.title||'(ë¬´ì œ)'}</div>
          <p class="text-sm opacity-90 line-clamp-3">${(it.content_text||it.description||'').replace(/<[^>]*>/g,'')}</p>
        </a>
      `).join('');
      el.innerHTML=`
        <div class="rounded-xl border border-zinc-200/60 dark:border-zinc-800/60">
          <div class="flex items-center justify-between p-3">
            <div class="font-semibold">${title}</div>
            <div class="text-xs opacity-70">via Cloudflare Worker</div>
          </div>
          <div class="grid md:grid-cols-2 gap-2 p-3 pt-0">${top||'<div class="p-3 text-sm opacity-70">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}</div>
        </div>`;
    }

    function renderError({mount,title,channel}){
      document.getElementById(mount).innerHTML=`
        <div class="rounded-xl border border-amber-300/60 dark:border-amber-700/60 p-3 bg-amber-50/60 dark:bg-amber-900/20">
          <div class="font-semibold mb-1">${title}</div>
          <p class="text-sm opacity-80 mb-2">í”¼ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
          <a class="inline-block px-3 py-2 text-sm rounded-xl border border-zinc-300 dark:border-zinc-700" target="_blank" href="https://t.me/s/${channel}">ì±„ë„ ì—´ê¸°</a>
        </div>`;
    }

    async function loadFeed({channel,title,mount}){
      document.getElementById(mount).innerHTML = `
        <div class="rounded-xl border border-zinc-200/60 dark:border-zinc-800/60 p-3">
          <div class="font-semibold mb-2">${title}</div>
          <div class="animate-pulse h-24 rounded-lg bg-zinc-200/60 dark:bg-zinc-800/60"></div>
        </div>`;
      try{
        const res = await fetch(`${WORKER_BASE}/api?ch=${encodeURIComponent(channel)}`);
        if(!res.ok) throw new Error('fetch failed');
        const data = await res.json();
        const items = data?.items || data?.entry || [];
        renderFeed({mount,title}, items);
      }catch(e){
        renderError({mount,title,channel});
      }
    }
    FEEDS.forEach(loadFeed);
  </script>

  <!-- TradingView ìœ„ì ¯: í…Œë§ˆì— ë§ì¶° ë™ì  ìƒì„± (ë¼ì´íŠ¸ì—ì„œ ê°€ë…ì„± ê°œì„ ) -->
  <script>
    function createWidget(containerId, src, config) {
      const el = document.getElementById(containerId);
      el.innerHTML = "";                       // ê¸°ì¡´ ìœ„ì ¯ ì œê±°
      const script = document.createElement("script");
      script.type = "text/javascript";
      script.src = src;
      script.async = true;
      // TradingViewëŠ” ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ì˜ í…ìŠ¤íŠ¸ë¡œ JSONì„ ë°›ìŒ
      script.innerHTML = JSON.stringify(config);
      const wrap = document.createElement("div");
      wrap.className = "tradingview-widget-container";
      const inner = document.createElement("div");
      inner.className = "tradingview-widget-container__widget";
      wrap.appendChild(inner);
      wrap.appendChild(script);
      el.appendChild(wrap);
    }

    function renderTradingView() {
      const isDark = document.documentElement.classList.contains("dark");
      const theme = isDark ? "dark" : "light";

      // 1) í‹°ì»¤ í…Œì´í”„ (íˆ¬ëª… í•´ì œ + í…Œë§ˆ ì ìš©)
      createWidget(
        "tv-ticker",
        "https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js",
        {
          symbols: [
            { proName: "HSI:HSI", title: "Hang Seng Index" },
            { proName: "HSI:HSTECH", title: "Hang Seng TECH" },
            { proName: "SSE:000001", title: "SSE Composite" },
            { proName: "FX_IDC:CNYKRW", title: "CNY/KRW" }
          ],
          showSymbolLogo: true,
          colorTheme: theme,
          isTransparent: false,
          displayMode: "adaptive",
          locale: "kr"
        }
      );

      // 2) ê²½ì œì§€í‘œ ìº˜ë¦°ë” (íˆ¬ëª… í•´ì œ + í…Œë§ˆ ì ìš©)
      createWidget(
        "tv-events",
        "https://s3.tradingview.com/external-embedding/embed-widget-events.js",
        {
          colorTheme: theme,
          isTransparent: false,
          width: "100%",
          height: "100%",
          locale: "kr",
          importanceFilter: "1",
          countryFilter: "us,cn"
        }
      );
    }

    // ìµœì´ˆ ë Œë”
    renderTradingView();
  </script>
</body>
</html>
